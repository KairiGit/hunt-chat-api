# ファイル形式ガイド

このドキュメントでは、HUNT システムにアップロードするファイルの形式要件について説明します。

## 📋 目次

1. [サポートされているファイル形式](#サポートされているファイル形式)
2. [必須列](#必須列)
3. [オプション列](#オプション列)
4. [データ形式の詳細](#データ形式の詳細)
5. [サンプルデータ](#サンプルデータ)
6. [よくある質問](#よくある質問)

---

## サポートされているファイル形式

以下の拡張子のファイルをアップロードできます：

| 拡張子 | 形式 | 説明 |
|--------|------|------|
| `.csv` | CSV | カンマ区切りテキストファイル |
| `.xlsx` | Excel | Microsoft Excel 形式 |

**注意**: `.xls`（旧Excelフ format）は現在サポートされていません。

---

## 必須列

ファイルには**以下の3つの列が必須**です。列名は柔軟に対応しています。

### 1. 日付列

**認識される列名:**
- `date`
- `日付`

**データ形式:**
- `YYYY-MM-DD` (例: `2024-01-15`)
- `YYYY/M/D` (例: `2024/1/15`)
- `YYYY/MM/DD` (例: `2024/01/15`)

**例:**
```
2024-01-01
2024-01-02
2024-01-03
```

---

### 2. 製品ID列（必須）

**認識される列名:**
- `製品ID`
- `製品id`
- `製品コード`
- `商品ID`
- `商品id`
- `商品コード`
- `product_code`
- `product_id`
- `product_ID`

**データ形式:**
- 任意の文字列（空白不可）
- システム内部で製品を識別するためのコード

**例:**
```
P001
P002
SKU-12345
```

---

### 3. 製品名列（オプション・推奨）

**認識される列名:**
- `製品名`
- `製品`
- `商品名`
- `商品`
- `product`
- `product_name`

**データ形式:**
- 任意の文字列
- ユーザー向けの表示名（AIの回答や異常通知で使用）

**例:**
```
製品A
コーヒー豆（ブレンド）
スマートフォンケース
```

**重要:** 製品名列がない場合、製品IDが表示に使用されます。

---

### 4. 販売数列（必須）

**認識される列名:**
- `sales`
- `quantity`
- `販売数`
- `数量`

**データ形式:**
- 整数または小数（数値）

**例:**
```
100
105.5
300
```

---

## オプション列

以下の列は**オプション**です。含めても無視されますが、将来のバージョンで活用される可能性があります。

| 列名（例） | 説明 | 現在の利用状況 |
|-----------|------|--------------|
| `単価`, `price` | 製品の単価 | ❌ 使用されていない |
| `売上金額`, `amount` | 販売数 × 単価 | ❌ 使用されていない |
| `曜日`, `day_of_week` | 曜日情報 | ❌ 使用されていない |
| `月`, `month` | 月情報 | ❌ 使用されていない |
| `年`, `year` | 年情報 | ❌ 使用されていない |

**重要**: 製品名列は必須ではありませんが、提供すると表示がより分かりやすくなります。その他のオプション列は現在使用されていません。

---

## データ形式の詳細

### 最小限のCSV例

```csv
date,product_id,sales
2024-01-01,P001,100
2024-01-02,P001,105
2024-01-03,P001,300
```

### 推奨形式（製品名を含む）

```csv
date,product_id,product_name,sales
2024-01-01,P001,コーヒー豆（ブレンド）,100
2024-01-02,P001,コーヒー豆（ブレンド）,105
2024-01-03,P001,コーヒー豆（ブレンド）,300
```

### 日本語列名の例

```csv
日付,製品コード,製品名,販売数
2024-01-01,P001,コーヒー豆（ブレンド）,100
2024-01-02,P001,コーヒー豆（ブレンド）,105
2024-01-03,P001,コーヒー豆（ブレンド）,300
```

### 追加列を含む例（推奨されるフル形式）

```csv
日付,製品コード,製品,販売数,単価,売上金額,曜日,月,年
2022-01-01,P001,製品A,48,1000,48000,土,1,2022
2022-01-01,P002,製品B,77,1500,115500,土,1,2022
2022-01-01,P003,製品C,97,2000,194000,土,1,2022
```

**解説:**
- システムは `日付`, `製品コード`, `製品`, `販売数` を使用
- `製品` 列（製品名）は推奨されるが必須ではない（AIの回答や異常通知で表示される）
- その他の列（`単価`, `売上金額`, `曜日`, `月`, `年`）は現在無視されるが、将来的に活用される可能性あり

---

## サンプルデータ

### サンプル1: 最小限（英語列名）

```csv
date,product_code,sales
2024-01-01,P001,100
2024-01-02,P001,105
2024-01-03,P001,300
2024-01-04,P002,150
2024-01-05,P002,155
```

### サンプル2: 日本語列名

```csv
日付,製品コード,販売数
2024-01-01,P001,100
2024-01-02,P001,105
2024-01-03,P001,300
2024-01-04,P002,150
2024-01-05,P002,155
```

### サンプル3: 推奨フル形式

プロジェクト内の `moc/moc.csv` を参照してください。

---

## よくある質問

### Q1: 列の順序は重要ですか？

**A:** いいえ、列の順序は自由です。システムはヘッダー行の列名で列を識別します。

**OK例:**
```csv
sales,date,product_code
100,2024-01-01,P001
```

---

### Q2: ヘッダー行は必須ですか？

**A:** はい、必須です。1行目はヘッダー行として扱われます。

---

### Q3: 複数の製品を1つのファイルに含められますか？

**A:** はい、できます。システムは製品コードごとに自動的にグループ化します。

---

### Q4: 日付が昇順でなくてもいいですか？

**A:** はい、日付の順序は問いません。システムが自動的にソートします。

---

### Q5: 欠損値がある場合はどうなりますか？

**A:** 欠損値がある行はスキップされます。以下のいずれかに該当する行は無視されます：
- 日付が空または解析できない
- 製品コードが空
- 販売数が空または数値でない

---

### Q6: 必須列以外の列を含めても問題ありませんか？

**A:** はい、問題ありません。システムは必須3列のみを使用し、その他の列は無視します。

**例:**
```csv
date,product_code,sales,temperature,campaign
2024-01-01,P001,100,15.5,true
```
→ `temperature` と `campaign` は無視されます。

---

### Q7: エラーメッセージ「必要な列が見つかりませんでした」が表示されます

**A:** ヘッダー行の列名を確認してください。以下のいずれかの組み合わせが必要です：

**日付列（必須）:**
- `date` または `日付`

**製品ID列（必須）:**
- `product_code`, `product_id`, `product_ID`, `製品ID`, `製品id`, `製品コード`, `商品ID`, `商品id`, `商品コード` のいずれか

**製品名列（推奨）:**
- `product`, `product_name`, `製品`, `製品名`, `商品`, `商品名` のいずれか

**販売数列（必須）:**
- `sales`, `quantity`, `販売数`, `数量` のいずれか

---

## まとめ

✅ **必須列**: `date` (日付), `product_id` (製品ID), `sales` (販売数)  
⭐ **推奨列**: `product_name` (製品名) - AIの回答や異常通知で表示される  
✅ **サポート形式**: CSV (.csv), Excel (.xlsx)  
✅ **追加列**: 含めてもOK（現在は無視される）  
✅ **列の順序**: 自由  
✅ **日付形式**: `YYYY-MM-DD`, `YYYY/M/D`, `YYYY/MM/DD`  
✅ **欠損値**: スキップされる

疑問点がある場合は、プロジェクト内の `moc/moc.csv` をサンプルとして参照してください。
