# 🏭 製造業向け需要予測システム - 週次分析機能

## 📋 概要

toB製造業向けに最適化された週次単位での販売実績分析・予測システムです。

## ✨ 主要機能

### 1. ⚙️ 設定ページ (`/settings`)
企業の業務に合わせた柔軟な設定が可能です。

#### 会社情報
- 会社名
- 通知先メールアドレス
- 会計年度開始月日

#### 分析設定
- **分析期間の単位**: 日次 / **週次（推奨）** / 月次
- **予測期間**: 1〜52週間（約1年）
- **信頼区間レベル**: 80%〜99%
- **営業日設定**: 稼働曜日の選択（月〜日）

#### 製品マスタ
- 製品ID、製品名、カテゴリ
- 単位（個、セット、台、パック、ロット）
- リードタイム（日数）

### 2. 📊 週次分析ページ (`/weekly-analysis`)
週単位で販売実績を集計・分析し、実用的な洞察を提供します。

#### サマリーカード
- **分析期間**: 対象週数と日付範囲
- **週平均売上**: 週ごとの平均販売数
- **成長率**: 期間全体の成長/減少トレンド
- **変動係数**: 需要の安定性指標

#### トレンド分析
- **方向性**: 上昇/横ばい/下降
- **ピーク週・最低週**: 需要の高低を特定
- **季節性**: 前半期/後半期の傾向分析

#### 週次内訳テーブル
各週ごとの詳細データ：
- 期間（月曜〜日曜）
- 合計売上・日平均売上
- 前週比（%）
- 営業日数
- 平均気温

#### 統計サマリー
- 週平均売上・中央値・標準偏差
- 最高週・最低週の特定

#### AI推奨事項
統計分析に基づく具体的なアクション：
- トレンドに応じた生産計画調整
- 変動が大きい場合の安全在庫推奨
- JIT生産の適用可能性判断
- 季節要因を考慮した在庫管理

### 3. 📈 製品別予測 (`/dashboard`)
既存の製品別需要予測機能も引き続き利用可能です。

- 1週間/2週間/1ヶ月の予測
- 日次内訳と信頼区間
- 曜日効果・季節性・トレンド分析

## 🔧 技術スタック

### バックエンド
- **言語**: Go
- **フレームワーク**: Gin
- **統計分析**:
  - 週次集計（月曜始まり）
  - ピアソン相関係数
  - 線形回帰（R²）
  - 標準偏差・変動係数
  - トレンド分析（上昇/横ばい/下降）
  - 季節性検出

### フロントエンド
- **フレームワーク**: Next.js 15 (Turbopack)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **UI**: shadcn/ui コンポーネント

### AI・データ
- **AI**: Azure OpenAI (洞察生成)
- **ベクトルDB**: Qdrant (RAG)
- **気象データ**: 過去3年分のキャッシュ

## 🚀 使用方法

### 1. 設定
```
1. /settings にアクセス
2. 「週次」を選択（toB製造業推奨）
3. 営業日を設定（例: 月〜金）
4. 予測期間を設定（例: 4週間）
5. 保存
```

### 2. 週次分析
```
1. /weekly-analysis にアクセス
2. 製品を選択（P001〜P005）
3. 期間を指定（例: 2024-01-01 〜 2024-03-31）
4. 「分析実行」ボタンをクリック
5. 結果を確認:
   - サマリーカードで概要把握
   - 週次内訳で詳細確認
   - 推奨事項で具体的アクション確認
```

### 3. 製品別予測
```
1. /dashboard にアクセス
2. 製品・期間を選択
3. 予測実行
4. 日次内訳・信頼区間・推奨事項を確認
```

## 📊 API エンドポイント

### 週次分析
```http
POST /api/v1/ai/analyze-weekly
Content-Type: application/json

{
  "product_id": "P001",
  "start_date": "2024-01-01",
  "end_date": "2024-03-31",
  "sales_data": []  // オプション
}
```

**レスポンス例**:
```json
{
  "success": true,
  "data": {
    "product_id": "P001",
    "product_name": "製品A",
    "analysis_period": "2024-01-01 ~ 2024-03-31",
    "total_weeks": 13,
    "weekly_summary": [
      {
        "week_number": 1,
        "week_start": "2024-01-01",
        "week_end": "2024-01-07",
        "total_sales": 700,
        "average_sales": 100,
        "week_over_week": 0,
        "business_days": 7
      }
    ],
    "overall_stats": {
      "average_weekly_sales": 720,
      "growth_rate": 15.3,
      "volatility": 0.18,
      "best_week": 10,
      "worst_week": 3
    },
    "trends": {
      "direction": "上昇",
      "average_growth": 2.8,
      "seasonality": "後半期に需要増加傾向"
    },
    "recommendations": [
      "📈 上昇トレンド（平均+2.8%/週）：需要増加に備えて生産能力の確保を推奨",
      "✅ 需要が安定しています：JIT生産方式の適用を検討可能"
    ]
  }
}
```

### 製品別予測
```http
POST /api/v1/ai/forecast-product
Content-Type: application/json

{
  "product_id": "P001",
  "product_name": "製品A",
  "period": "week",  // week/2weeks/month
  "region_code": "240000"
}
```

## 💡 なぜ週次分析なのか？

### toB製造業に最適な理由

1. **生産計画サイクルに適合**
   - 多くの製造業は週単位で生産計画を立てる
   - 発注・納品サイクルが週次ベース

2. **データの意味のある集約**
   - 日次だと変動が大きすぎて傾向がわかりにくい
   - 月次だと対応が遅れる可能性
   - 週次が最適なバランス

3. **営業日の考慮**
   - 土日休業などの企業カレンダーに対応
   - 営業日ベースでの正確な分析

4. **実用的な推奨事項**
   - 週単位の具体的なアクションが可能
   - 在庫管理・生産調整が現実的

## 📈 統計指標の見方

### 変動係数（Volatility）
- **< 0.15**: 非常に安定 → JIT生産可能
- **0.15 - 0.30**: 普通 → 標準的な在庫管理
- **> 0.30**: 変動大 → 安全在庫必須

### 前週比（Week over Week）
- **> +5%**: 急成長 → 供給体制強化
- **-5% ~ +5%**: 安定 → 現状維持
- **< -5%**: 減少 → マーケティング施策検討

### 成長率（Growth Rate）
- 期間全体の最初の週と最後の週を比較
- **> +20%**: 高成長市場
- **-20% ~ +20%**: 安定市場
- **< -20%**: 縮小市場

## 🎯 今後の拡張予定

- [ ] 複数製品の比較分析
- [ ] エクセルエクスポート機能
- [ ] 自動アラート機能（異常検知時）
- [ ] 実データとの統合
- [ ] カスタムレポート生成
- [ ] 週の開始曜日設定（月曜/日曜）
- [ ] 長期トレンド予測（26週/52週）

## 🏆 ベストプラクティス

1. **最低3ヶ月（12週）のデータを用意**
   - 短すぎるとトレンドが不正確

2. **定期的な分析実行**
   - 毎週月曜に前週分析を実行
   - 月初に前月分析を実行

3. **推奨事項の活用**
   - AIが生成する推奨事項を生産計画に反映
   - 異常週の原因を記録・分析

4. **設定の最適化**
   - 信頼区間: 95%推奨（バランス型）
   - 予測期間: 4週間推奨（1ヶ月先）

---

**製造業の需要予測を、より実用的に。**
