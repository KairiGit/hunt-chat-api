# HUNT Chat-API 利用マニュアル

`v1.0.0` - 2025-10-09

## 1. はじめに

このドキュメントは、HUNT Chat-APIの利用方法について説明します。
本APIは、販売実績や気象データなどの外部データを取り込み、AIによる分析、チャット対話、需要予測機能を提供することを目的としています。

- **本番環境ベースURL**: `https://hunt-chat-api.vercel.app`
- **プレビュー環境ベースURL**: 各デプロイごとに発行される一時的なURL

## 2. 認証

本APIのすべてのエンドポイント（`/api/v1/...`）は、APIキーによる認証で保護されています。
APIを呼び出す際は、HTTPリクエストのヘッダーにAPIキーを含める必要があります。

- **ヘッダー名**: `X-API-KEY`
- **値**: 事前に発行されたAPIキー

```sh
curl -X POST \
  -H "X-API-KEY: YOUR_SECRET_API_KEY" \
  https://hunt-chat-api.vercel.app/api/v1/...
```

正しいAPIキーが提供されない場合、サーバーは `401 Unauthorized` エラーを返します。

## 3. データ保管のアーキテクチャ

本APIは、データの種類に応じて2つのデータベースを使い分けます。

### 3.1. 構造化データ（生データ）

- **対象**: 販売実績、製品マスター、顧客マスターなど、テーブル形式の元データ。
- **保管場所**: **APIの呼び出し元である業務アプリケーション側のRDB（PostgreSQLなど）**で管理されることを前提とします。
- **本APIの役割**: 本APIは、これらの生データを**直接保管しません**。API経由で一時的に受け取り、分析・要約処理に利用します。

### 3.2. 非構造化データ（意味・文脈）

- **対象**: AIが文脈を理解するためのテキスト情報。
  - ファイルから抽出・要約された「分析サマリー」
  - AIとの「チャットの対話履歴」
  - 外部データから得られた「洞察」や「分析結果」
- **保管場所**: 本APIに接続された**Qdrant（ベクトルデータベース）**に永続化します。
- **本APIの役割**: テキスト情報をベクトル化し、Qdrantに保存します。これにより、AIは過去の対話や分析結果を「記憶」し、意味的に類似した情報を検索して、より高度な回答を生成できます。

## 4. APIリファレンス

### 4.1. AI統合API

#### ファイル分析

- **エンドポイント**: `POST /api/v1/ai/analyze-file`
- **概要**: アップロードされたファイル（Excel, CSV）を分析し、内容を要約します。要約結果は、後続のチャットのコンテキストとして利用できます。
- **リクエスト形式**: `multipart/form-data`
  - `file`: 分析対象のファイル
- **レスポンス形式**: `200 OK`
  ```json
  {
    "success": true,
    "summary": "AIによって生成されたファイルの要約テキスト..."
  }
  ```

#### AIチャット

- **エンドポイント**: `POST /api/v1/ai/chat-input`
- **概要**: コンテキスト（分析サマリーなど）とユーザーの質問を元に、AIが応答を返します。応答はストリーミング形式で返却されます。
- **リクエスト形式**: `application/json`
  ```json
  {
    "chat_message": "このデータの傾向を教えてください。",
    "context": "（ファイル分析で得られたサマリーなど、AIに与えたい文脈）"
  }
  ```
- **レスポンス形式**: `200 OK`
  - `Content-Type`: `text/plain; charset=utf-8`
  - AIが生成したテキストが、断片的にストリーミングで送信されます。

---

### 4.2. データ連携API (Phase 1で実装予定)

#### マスターデータ取込

- **エンドポイント**: `POST /api/v1/data/master`
- **概要**: 外部システムからマスターデータ（製品、店舗、地域など）を受け取り、ベクトル化してQdrantに保存します。
- **リクエスト形式**: `application/json`
  ```json
  [
    {
      "type": "product",
      "id": "P001",
      "name": "天然水",
      "category": "飲料",
      "description": "南アルプスの自然が育んだ、すっきりとキレのある味わいのナチュラルミネラルウォーターです。"
    },
    {
      "type": "region",
      "id": "240000",
      "name": "三重県",
      "description": "日本の都道府県の一つ。県庁所在地は津市。"
    }
  ]
  ```
- **レスポンス形式**: `200 OK`
  - データ取込とベクトル化は非同期で実行されるため、リクエスト受付成功のステータスを返します。
